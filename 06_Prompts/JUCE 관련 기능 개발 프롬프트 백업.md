재생 기능을 구현하고 싶어.
지금 재생기능에서 어려운 부분은 아마 tempo에 따른 재생 시간 계산일텐데 Flicks을 사용해서 구현해줘.
@web https://github.com/facebookarchive/Flicks

내가 기대하는 오디오 엔진의 동작은 note의 음과 박자에 맞게 오디오를 한번 렌더링하고, 이를 재생하는 것이며, 렌더링이 완료되면 웨이브폼을 보여줬으면 좋겠어. 

웨이브폼의 위치는 pianoroll의 아래쪽 절반인데 완전히 아래에 붙히기 보다는 살짝 위로 올렸으면 좋겠고 이는 스크롤과 관계없이 높이가 고정되어 있어야되.
그리고, 웨이브폼이 그리드나 노트를 가리지 않도록 약간 투명하게 해줬으면 좋겠고, 추후 추가될 기능을 위해 다음과 같이 레이어를 쌓는 느낌으로 구성이 되었으면 좋겠어.

최상단 (Playhead 등)
|
노트
|
웨이브폼
|
그리드

마지막으로 flicks 기능이 잘 동작하는지 확인하기 위해 playhead 위치나 노트들의 flicks 정보를 보여주는 디버그 컴포넌트가 있으면 좋을 것 같아. 소리는 일단 키보드 건반을 누를때 나오는 소리를 이용하도록 하면 좋을 것 같아.

피치 곡선을 출력하는 기능을 추가하고 싶어.
이전에 레이어를 쌓는 구조로 기능을 추가했는데, 다음과 같이 레이어를 구성하면 되.

최상단 (Playhead 등)
|
피치 곡선
|
노트
|
웨이브폼
|
그리드

다만, 피치 곡선이 위에 보이더라도 기존처럼 노트를 제어할 수 있어야되.

내가 요청한 피치 곡선 기능은 사용자에게 보여주기 위한 기능이라 수정 가능하게 만들 필요가 없어 그리고, 피치곡선은 음 높이를 나타내기때문에 노트와 같은 위치에 출력이 될거고, 이전의 waveform처럼 특정 높이에 고정될 필요 없어

데이터 흐름을 구현할 차례야.

현재 내가 구상하고 있는 아이디어는 다음과 같아.

이 컴포넌트를 input으로 사용할 경우, 미디 시퀀스, 오디오, f0 (피치 곡선), duration (발음 지속시간)을 받으려고 하고 있고, 모든 데이터가 동시에 들어오기보다는 같이 들어올 수 도 있고, 하나만 들어올 수 도 있어.

output으로 사용할 경우, 노트와 트랙에 대한 정보가 다음과 같이 주어질거야.

{
tempo: int,
notes: [
  {
    id,
    start,
    duration,
    pitch,
    lyrics
  }
]
}

이때, duration과 start는 딥러닝 모델에서 nano second를 사용하는 경우가 많아서 flick과 ns를 상호 변환하는 유틸 함수가 필요할 수 있어.

그리고 change 이벤트는 노트가 생성/삭제/이동하거나 템포가 변할 때, 발생하며, 보통 이 이벤트는 실시간 처리에 사용되기 떄문에 지속적으로 벡엔드에 정보를 전달하기 위해 사용될거야.

